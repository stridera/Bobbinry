id: manuscript
name: Manuscript
version: 1.0.0
author: Bobbinry Team
description: Complete manuscript management with books, chapters, and scenes
tags:
  - writing
  - manuscript
  - storytelling
license: Apache-2.0

capabilities:
  publishable: true
  external: false
  ai: true
  customViews: false

data:
  collections:
    - name: books
      displayName: Books
      fields:
        - name: title
          type: text
          displayName: Title
          required: true
          validation:
            required: true
        - name: description
          type: markdown
          displayName: Description
        - name: genre
          type: text
          displayName: Genre
        - name: target_words
          type: number
          displayName: Target Word Count
        - name: status
          type: text
          displayName: Status
          default: draft
        - name: created_at
          type: datetime
          displayName: Created At
        - name: updated_at
          type: datetime
          displayName: Updated At
      hints:
        searchable: [title, description, genre]
        sortKey: created_at
        displayField: title
        icon: book

    - name: chapters
      displayName: Chapters
      fields:
        - name: title
          type: text
          displayName: Title
          required: true
        - name: description
          type: text
          displayName: Description
        - name: order
          type: number
          displayName: Order
          required: true
        - name: word_count
          type: number
          displayName: Word Count
          default: 0
        - name: created_at
          type: datetime
          displayName: Created At
        - name: updated_at
          type: datetime
          displayName: Updated At
      relationships:
        - name: book
          type: one-to-many
          target: books
          foreignKey: book_id
          displayName: Book
      hints:
        searchable: [title, description]
        sortKey: order
        displayField: title
        icon: bookmark

    - name: scenes
      displayName: Scenes
      fields:
        - name: title
          type: text
          displayName: Title
          required: true
        - name: description
          type: text
          displayName: Description
        - name: body
          type: rich_text
          displayName: Content
        - name: order
          type: number
          displayName: Order
          required: true
        - name: word_count
          type: number
          displayName: Word Count
          default: 0
        - name: status
          type: text
          displayName: Status
          default: draft
        - name: notes
          type: markdown
          displayName: Notes
        - name: created_at
          type: datetime
          displayName: Created At
        - name: updated_at
          type: datetime
          displayName: Updated At
      relationships:
        - name: chapter
          type: one-to-many
          target: chapters
          foreignKey: chapter_id
          displayName: Chapter
      hints:
        searchable: [title, description, body]
        sortKey: order
        displayField: title
        icon: file-text

ui:
  views:
    - id: outline
      type: tree
      name: Outline
      source: books
      layout:
        groups:
          - field: status
            direction: asc
        sort:
          - field: order
            direction: asc
      actions:
        - create_book
        - create_chapter
        - create_scene
        - reorder

    - id: editor
      type: editor
      name: Scene Editor
      source: scenes
      layout:
        columns:
          - field: title
            width: 100%
          - field: body
            width: 100%
      actions:
        - save
        - auto_save
        - word_count_update

interactions:
  actions:
    - id: create_book
      name: Create Book
      type: create
      target: books
      parameters:
        - name: title
          type: text
          required: true
        - name: description
          type: text
          required: false

    - id: create_chapter
      name: Create Chapter
      type: create
      target: chapters
      parameters:
        - name: title
          type: text
          required: true
        - name: book_id
          type: reference
          required: true

    - id: create_scene
      name: Create Scene
      type: create
      target: scenes
      parameters:
        - name: title
          type: text
          required: true
        - name: chapter_id
          type: reference
          required: true

    - id: reorder
      name: Reorder Items
      type: update
      parameters:
        - name: items
          type: json
          required: true

  triggers:
    - id: update_word_count
      event: update
      conditions:
        - field: body
          operator: ne
          value: null
      actions:
        - word_count_update

linking:
  entities:
    - collection: books
      display:
        template: "{{title}}"
        preview: [title, description, status]
    - collection: chapters
      display:
        template: "{{title}} ({{book.title}})"
        preview: [title, description, word_count]
    - collection: scenes
      display:
        template: "{{title}} ({{chapter.title}})"
        preview: [title, description, word_count, status]

publish:
  entities:
    - books
    - chapters
    - scenes
  fields:
    - title
    - body
    - description
    - order
  output:
    - format: html
      template: manuscript_template
    - format: pdf
      template: manuscript_pdf
    - format: epub
      template: manuscript_epub

compatibility:
  minShellVersion: "0.1.0"