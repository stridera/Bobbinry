id: manuscript
name: Manuscript
version: 1.0.0
author: Bobbinry Team
description: Complete manuscript management with books, chapters, and scenes
tags:
  - writing
  - manuscript
  - storytelling
license: Apache-2.0

capabilities:
  publishable: true
  external: false
  ai: true
  customViews: false

execution:
  mode: native
  signature: dev_mode_skip

extensions:
  contributions:
    - slot: shell.leftPanel
      type: panel
      id: navigation
      title: "Manuscript"
      entry: panels/navigation
      priority: 10
      when:
        inView: project

data:
  collections:
    - name: containers
      displayName: Containers
      fields:
        - name: title
          type: text
          displayName: Title
          required: true
        - name: parent_id
          type: text
          displayName: Parent Container
          required: false
        - name: type
          type: text
          displayName: Type
          required: true
          default: folder
        - name: order
          type: number
          displayName: Order
          required: true
        - name: icon
          type: text
          displayName: Icon
          required: false
        - name: metadata
          type: json
          displayName: Metadata
          required: false
        - name: created_at
          type: datetime
          displayName: Created At
        - name: updated_at
          type: datetime
          displayName: Updated At
      relationships:
        - name: parent
          type: one-to-many
          target: containers
          foreignKey: parent_id
          displayName: Parent Container
      hints:
        searchable: [title, type]
        sortKey: order
        displayField: title
        icon: folder

    - name: content
      displayName: Content
      fields:
        - name: title
          type: text
          displayName: Title
          required: true
        - name: container_id
          type: text
          displayName: Container
          required: true
        - name: type
          type: text
          displayName: Type
          required: true
          default: scene
        - name: body
          type: rich_text
          displayName: Content
        - name: order
          type: number
          displayName: Order
          required: true
        - name: word_count
          type: number
          displayName: Word Count
          default: 0
        - name: status
          type: text
          displayName: Status
          default: draft
        - name: notes
          type: markdown
          displayName: Notes
        - name: metadata
          type: json
          displayName: Metadata
          required: false
        - name: created_at
          type: datetime
          displayName: Created At
        - name: updated_at
          type: datetime
          displayName: Updated At
      relationships:
        - name: container
          type: one-to-many
          target: containers
          foreignKey: container_id
          displayName: Container
      hints:
        searchable: [title, body, notes]
        sortKey: order
        displayField: title
        icon: file-text

ui:
  views:
    - id: outline
      type: tree
      name: Outline
      source: views/outline
      handlers:
        - container
      priority: 10
      layout:
        sort:
          - field: order
            direction: asc
      actions:
        - create_container
        - create_content
        - reorder

    - id: editor
      type: editor
      name: Content Editor
      source: views/editor
      handlers:
        - content
      priority: 10
      layout:
        columns:
          - field: title
            width: 100%
          - field: body
            width: 100%
      actions:
        - save
        - auto_save
        - word_count_update

interactions:
  actions:
    - id: create_container
      name: Create Container
      type: create
      target: containers
      parameters:
        - name: title
          type: text
          required: true
        - name: type
          type: text
          required: true
        - name: parent_id
          type: reference
          required: false

    - id: create_content
      name: Create Content
      type: create
      target: content
      parameters:
        - name: title
          type: text
          required: true
        - name: type
          type: text
          required: true
        - name: container_id
          type: reference
          required: true

    - id: reorder
      name: Reorder Items
      type: update
      parameters:
        - name: items
          type: json
          required: true

  triggers:
    - id: update_word_count
      event: update
      conditions:
        - field: body
          operator: ne
          value: null
      actions:
        - word_count_update

linking:
  entities:
    - collection: containers
      display:
        template: "{{title}}"
        preview: [title, type]
    - collection: content
      display:
        template: "{{title}}"
        preview: [title, type, word_count, status]

publish:
  entities:
    - containers
    - content
  fields:
    - title
    - body
    - type
    - order
  output:
    - format: html
      template: manuscript_template
    - format: pdf
      template: manuscript_pdf
    - format: epub
      template: manuscript_epub

compatibility:
  minShellVersion: "0.1.0"